?????, (AbandonWare). ? application-ultra.properties ?? ??? ???? ?? ??? ??? ?? ??? ??? ?????.

# --------------------------------------------------------------------------
# Disable LangChain4j auto-configuration for all profiles.  When using
# manual OpenAI model builders the starter must be excluded across every
# active configuration.  Without this exclusion the Spring Boot autoconfig
# will attempt to create its own ChatModel beans using a missing API key,
# resulting in authentication failures at runtime.
spring.autoconfigure.exclude=\
  dev.langchain4j.spring.AiAutoConfiguration,\
  dev.langchain4j.spring.autoconfigure.REPLACE_ME,\
  dev.langchain4j.service.spring.REPLACE_ME,\
  dev.langchain4j.model.openai.spring.autoconfigure.OpenAiAutoConfiguration

diff? ??? ????(???? ??, Self-Ask ? Tavily ?? ??)? ?? ultra ????? ?? ??? ???? ??????.

?? ?? ??: application-ultra.properties
? ??? src/main/resources/application-ultra.properties ??? ????? ???.

Properties

################################################################################
#  "??? ???" ???? (?? ??, ?? ??) ??
#  ? ????? ???? ??? ??? ????, ?? ??(production) ?????
#  ??? ????? ? ???.
################################################################################

## ===================================================================
##  1. ?? ?? ? ?? ?? (Log Level & Console Pattern)
## ===================================================================
# [??] ?? ?? ??? INFO? ???? ???? ??? ????.
logging.level.root=INFO

# [??] '? ??????' ???? TRACE ??? ?????.
# API ??, ??? ?? ? ?? ??? ?? ??? ? ? ??? ?????.
# "com.example.lms"? ????, ?? ???? ??? ??? ??? ???.
logging.level.com.example.lms=TRACE

# ?? ??? ANSI ??? ???, ???? ???? ID? ?????.
spring.output.ansi.enabled=ALWAYS
logging.pattern.console=%d{HH:mm:ss.SSS} %highlight{%5p} [%15.15t] trace=%X{traceId:-} %cyan{%-40.40logger{39}} : %msg%n%wEx


## ===================================================================
##  2. HTTP ??/?? ?? ?? (Full HTTP Request/Response Analysis)
## ===================================================================
# ??: API ?/????? ??? ??? ? ????. (?? ?? ??)
spring.mvc.log-request-details=true
spring.webflux.log-request-details=true
logging.level.org.springframework.web=TRACE
# Spring Web ?? ??? TRACE? ?????. (?? ??)
# Netty ????? ?? raw bytes(16??)? ?????.
spring.reactor.netty.http.server.wiretap=true
spring.reactor.netty.http.client.wiretap=false
# WebClient(?? API ??) ??/?? ?? ? ??? ?????.
logging.level.org.springframework.web.reactive.function.client.ExchangeFunctions=TRACE


## ===================================================================
##  3. ?????? & JPA/Hibernate (Database & JPA/Hibernate)
## ===================================================================
# ??: ??? ??? ?? ??? ??? ? ????.

# [??] Hibernate? Hikari? ?? ??? WARN ??? ????.
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=WARN

# ???? ?? SQL?? ????? ?????.
logging.level.org.hibernate.SQL=DEBUG
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# SQL '?'? ????? ???? ?? TRACE ??? ?????.
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE


## ===================================================================
##  4. LLM & ? ?? (LLM & Web Search - Custom)
## ===================================================================
# ??: ????? ??? ?? ???? ??? ??? ??? ? ? ????.
lms.debug.enabled=true
lms.debug.thinking.enabled=true
lms.debug.prompts.dump=true
lms.debug.responses.dump=true
lms.debug.websearch.enabled=true
lms.debug.websearch.dump.curl=true

# [??] API ? ? ?? ??? ????? ????. ?? ??? ?? ???? ???.
lms.debug.mask-secrets=REPLACE_ME

## ===================================================================
##  5. ?? ?? & ????? (Distributed Tracing & Actuator)
## ===================================================================
management.tracing.enabled=true
management.tracing.sampling.probability=1.0
management.endpoint.httptrace.enabled=true
management.endpoint.beans.enabled=true
management.endpoint.env.enabled=true
management.endpoints.web.exposure.include=httptrace,beans,env,health,info


## ===================================================================
##  6. ??? ????? (?? ??)
## ===================================================================
# [??] Spring ????? ??? WARN?? ???? ?? ??? ???.
logging.level.org.springframework=WARN

# ?, API ??? ??? Security? Transaction ??? ??? ???.
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.transaction=TRACE

# ?? ?????? LangChain4j? OpenAI ??? ??? ???.
logging.level.dev.langchain4j=TRACE


## ===================================================================
##  7. ?? ??? ?? (Detailed Error Configuration)
## ===================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-exception=true
server.error.include-stacktrace=always

## ===================================================================
##  8. ?????? ???? (Diff ??)
## ===================================================================
naver.hedge.timeout-ms=1000

# Self-Ask Retriever ?? (API ??? ??)
selfask.max-depth=2
selfask.max-api-calls-per-query=8
selfask.followups-per-level=2
selfask.REPLACE_ME=3
# ? NEW: Self?Ask ????(??/??)
selfask.timeout-seconds=10
selfask.per-request-timeout-ms=5000

# (??) Tavily ??
tavily.enabled=false
tavily.api.url=https://api.tavily.com/search
tavily.api.key=REPLACE_ME
tavily.max-results=5
tavily.timeout-ms=3000
rag.safety.enforceSid=true
rag.index.transient-namespace=__TRANSIENT__
rag.snippet.index-web-default=false
rag.snippet.ttl-days=14
rag.embedding.dimension-guard=true
naver.filters.enable-domain-filter=true
naver.filters.domain-policy=boost
naver.search.query-suffix=
# enable DuckDuckGo fallback by default to improve coverage
naver.fallback.duckduckgo.enabled=${NAV_FALLBACK_DDG:true}
router.allow-header-override=false

# === [LLM Health ???] LlmHealth? ???? llm.* ?? openai.* ?? ?? ===
# Groq provider: default to Groq (OpenAI-compatible) with environment overrides
llm.provider=groq
llm.base-url=https://api.groq.com/openai/v1
# Groq ?? ??(??? ?? ??) ? ???? ?? ??
llm.api-key=REPLACE_ME
llm.chat-model=llama-3.1-8b-instant

# Brave 검색 공통 설정 (QPS/타임아웃/기본 카운트)
search.brave.enabled=${BRAVE_ENABLED:true}
search.brave.base-url=${BRAVE_BASE_URL:https://api.search.brave.com}
search.brave.api-key=REPLACE_ME
search.brave.qps=${BRAVE_QPS:1}
search.brave.count=${BRAVE_COUNT:8}
search.brave.timeout-ms=${BRAVE_TIMEOUT_MS:2500}

# Upstash Redis/Vector
upstash.redis.enabled=${UPSTASH_REDIS_ENABLED:false}
upstash.redis.rest-url=${UPSTASH_REDIS_REST_URL:}
upstash.redis.rest-token=<REDACTED>
upstash.cache.ttl-seconds= ${UPSTASH_CACHE_TTL:600}
upstash.ratelimit.per-minute=${UPSTASH_RATE_PER_MIN:30}

upstash.vector.rest-url=${UPSTASH_VECTOR_URL:}
upstash.vector.api-key=REPLACE_ME
upstash.vector.namespace=${UPSTASH_VECTOR_NS:aw-default}
upstash.vector.read-only=${UPSTASH_VECTOR_RO:true}

# === [MOE Routing Defaults] Prefer high-capability model by default (override per env as needed)
#router.moe.mini=gpt-5-mini
#router.moe.high=gpt-5-chat-latest
#router.moe.threshold=0.62
#router.moe.margin=0.08
#langchain4j.openai.chat-model.model-name=gpt-5-mini
#openai.model.moe=gpt-5-chat-latest
naver.filters.domain-allowlist=go.kr,ac.kr,hoyoverse.com,hoyolab.com
search.budget.per-page-ms=3500

# === Query Extraction Switch ===
# Extraction mode can be RULE, LLM, HYBRID or AUTO. When AUTO the system
# decides which strategy to use based on query complexity. See
# HybridKeywordExtractor for details.
search.extractor.mode=AUTO
# In AUTO mode, queries shorter than this many characters are treated as
# simple and expanded via the rule based extractor.
search.extractor.auto.min-chars=12
# LLM calls are timeboxed by the transformer; this value controls the upper
# bound (in milliseconds) after which the extractor will fallback to the
# rule based path. Not currently used in this implementation but reserved
# for future tuning.
search.extractor.auto.llm-timeout-ms=800
# Maximum number of queries returned for the GENERAL domain in AUTO mode.
search.extractor.auto.general-cap=8
# Maximum number of queries returned for specialised domains in AUTO mode.
search.extractor.auto.special-cap=4
# Jaccard deduplication threshold for the GENERAL domain.
search.extractor.jaccard.general=0.60
# Jaccard deduplication threshold for specialised domains.
search.extractor.jaccard.special=0.80

# LLM generation caps (delegated to QueryTransformer)
search.llm.max-variants=3
search.llm.max-hints=4
search.llm.cache-ttl-min=5

# Select the backend for LLM powered keyword extraction.  Supported
# values are 'lc4j' (default) and 'gemini'.  When set to 'gemini' and a
# GeminiClient bean is available the system will query Gemini for
# keyword variants.  Otherwise LangChain4j is used.  See
# HybridKeywordExtractor for details.
search.llm.backend=gemini

# === Weighted RRF Fusion ===
# Base offset used in the weighted RRF formula.  Larger values dampen the
# contribution of lower ranked documents.  Recommended range 60–100.
fusion.rrf.k=60
# Per-provider weights controlling the influence of each search provider.
# Higher weights boost the provider's results in the fused ranking.  A weight
# of 1.0 implies equal importance; values below 1.0 downweight the provider.
fusion.rrf.weight.Naver=1.0
fusion.rrf.weight.Bing=0.9
fusion.rrf.weight.Tavily=0.8

# -------------------------------------------------------------------------------
#  Resilience4j settings for Gemini keyword extraction
#
# These properties configure a TimeLimiter, Retry and CircuitBreaker for the
# 'geminiKeyword' instance used by the GeminiClient.  When unspecified
# reasonable defaults will be used, but explicit configuration enables the
# resilience decorator in GeminiClient.keywordVariants() to operate with
# predictable thresholds.  See SmartQueryPlanner and HybridKeywordExtractor
# for the calling context.
resilience4j.timelimiter.instances.geminiKeyword.timeoutDuration=REPLACE_ME
resilience4j.retry.instances.geminiKeyword.maxAttempts=REPLACE_ME
resilience4j.retry.instances.geminiKeyword.waitDuration=REPLACE_ME
resilience4j.circuitbreaker.instances.geminiKeyword.slidingWindowSize=REPLACE_ME
resilience4j.circuitbreaker.instances.geminiKeyword.failureRateThreshold=REPLACE_ME