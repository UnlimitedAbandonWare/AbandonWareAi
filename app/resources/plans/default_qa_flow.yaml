plan:
  id: "default_qa_flow"
  version: "1.0"
  steps:
    - name: "AnalyzeQuery"
      action: "self_ask"
      output: "refined_query"
    - name: "DynamicRetrieval"
      action: "hybrid_search"
      input: "refined_query"
      output: "retrieved_docs"
    - name: "FuseResults"
      action: "fuse"
      method: "WeightedRRF"
      input: "retrieved_docs"
      output: "fused_docs"
    - name: "BiEncoderRank"
      action: "rerank"
      model: "BiEncoder"
      input: "fused_docs"
      output: "reranked_docs"
    - name: "CrossEncoderRank"
      when: "${onnx.enabled}"
      action: "rerank"
      model: "CrossEncoder"
      input: "reranked_docs"
      output: "reranked_docs"
    - name: "GenerateAnswer"
      action: "generate"
      model: "LLaMA-13B"
      input: "reranked_docs"
      output: "raw_answer"
    - name: "PostProcess"
      action: "apply_guards"
      guards: ["AnswerLengthGovernor", "AnswerSanitizer", "CitationGate", "FinalSigmoidGate"]
      input: "raw_answer"
      output: "final_answer"
  fallback:
    - condition: "error_at:DynamicRetrieval"
      action: "vector_search_only"
    - condition: "error_at:CrossEncoderRank"
      action: "skip_step"
    - condition: "error_at:GenerateAnswer"
      action: "return_safe_reply"
      reply: "죄송합니다, 답변을 생성할 수 없습니다."