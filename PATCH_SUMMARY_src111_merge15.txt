==== src/main/java/com/abandonware/ai/agent/consent/ConsentService.java ====
--- src/main/java/com/abandonware/ai/agent/consent/ConsentService.java (before)+++ src/main/java/com/abandonware/ai/agent/consent/ConsentService.java (after)@@ -26,7 +26,7 @@      * Returns true if the provided token covers all of the required
      * scopes.  Expired grants are treated as absent.
      */
-    boolean has(ConsentToken token, ToolScope… required);
+    boolean has(ConsentToken token, ToolScope... required);
 
     /**
      * Ensures that the provided token covers all required scopes.  If any


==== src/main/java/com/abandonware/ai/agent/consent/BasicConsentService.java ====
--- src/main/java/com/abandonware/ai/agent/consent/BasicConsentService.java (before)+++ src/main/java/com/abandonware/ai/agent/consent/BasicConsentService.java (after)@@ -30,7 +30,7 @@     }
 
     @Override
-    public boolean has(ConsentToken token, ToolScope… required) {
+    public boolean has(ConsentToken token, ToolScope... required) {
         if (token == null || required == null || required.length == 0) {
             return true;
         }


==== src/main/java/com/abandonware/ai/agent/consent/RedisConsentService.java ====
--- src/main/java/com/abandonware/ai/agent/consent/RedisConsentService.java (before)+++ src/main/java/com/abandonware/ai/agent/consent/RedisConsentService.java (after)@@ -1,24 +1,17 @@ package com.abandonware.ai.agent.consent;
 
 import com.abandonware.ai.agent.tool.ToolScope;
-import com.fasterxml.jackson.core.type.TypeReference;
 import com.fasterxml.jackson.databind.ObjectMapper;
 import org.springframework.data.redis.core.StringRedisTemplate;
+
 import java.time.Duration;
 import java.time.Instant;
 import java.util.Collections;
 import java.util.EnumSet;
-import java.util.List;
 import java.util.Set;
 
-
-
-
 /**
- * Redis-backed implementation of {@link ConsentService}. Stores a single
- * JSON record per session under the key {@code consent:grant:{sessionId}}
- * with a Redis TTL corresponding to the grant expiry. This provides simple
- * durability so that consent persists across application restarts.
+ * Redis-backed implementation of {@link ConsentService}.
  */
 public class RedisConsentService implements ConsentService {
 
@@ -39,7 +32,6 @@         }
         if (scopes == null) scopes = Collections.emptySet();
         Instant expiresAt = Instant.now().plusSeconds(ttlSeconds);
-        Grant grant = new Grant(sessionId, scopes, expiresAt);
         try {
             String json = objectMapper.writeValueAsString(new StoredGrant(scopes, expiresAt.toEpochMilli()));
             redis.opsForValue().set(key(sessionId), json, Duration.ofSeconds(ttlSeconds));
@@ -55,14 +47,14 @@     }
 
     @Override
-    public boolean has(ConsentToken token, ToolScope… required) {
+    public boolean has(ConsentToken token, ToolScope... required) {
         if (token == null || token.sessionId() == null) return false;
         StoredGrant sg = read(token.sessionId());
         if (sg == null) return false;
+        if (sg.expiresAtMillis < Instant.now().toEpochMilli()) return false;
+        if (required == null || required.length == 0) return true;
         Set<ToolScope> granted = EnumSet.noneOf(ToolScope.class);
         granted.addAll(sg.scopes);
-        if (sg.expiresAtMillis < java.time.Instant.now().toEpochMilli()) return false;
-        if (required == null || required.length == 0) return true;
         for (ToolScope r : required) {
             if (!granted.contains(r)) return false;
         }
@@ -98,4 +90,4 @@             this.expiresAtMillis = expiresAtMillis;
         }
     }
-}+}


==== src/main/java/com/abandonware/ai/agent/integrations/KakaoPlacesClient.java ====
--- src/main/java/com/abandonware/ai/agent/integrations/KakaoPlacesClient.java (before)+++ src/main/java/com/abandonware/ai/agent/integrations/KakaoPlacesClient.java (after)@@ -7,27 +7,26 @@ import java.util.List;
 import java.util.Map;
 
-
-
-
 /**
- * shim implementation of the Kakao Places client.  This service is used by
- * the {@code places.search} tool to look up nearby points of interest.  In
+ * Shim implementation of the Kakao Places client. This service is used by
+ * the {@code places.search} tool to look up nearby points of interest. In
  * this shim the query always returns an empty list; implementors should
- * replace this with a real call to the Kakao Local Search API.
+ * replace this with a real HTTP client that calls Kakao's Local API.
  */
 @Service
-
-    // Guard: enable external call only when API key is configured.
-private static boolean apiEnabled() {
-    return System.getenv("KAKAO_REST_KEY") != null && !System.getenv("KAKAO_REST_KEY").isEmpty();
-}
+public class KakaoPlacesClient {
 
     private static final Logger log = LoggerFactory.getLogger(KakaoPlacesClient.class);
+
+    /** Guard: enable external call only when API key is configured. */
+    static boolean apiEnabled() {
+        String key = System.getenv("KAKAO_REST_KEY");
+        return key != null && !key.isEmpty();
+    }
 
     public List<Map<String, Object>> search(String query, Double x, Double y, Integer radius) {
         log.info("[KakaoPlacesClient] search query={} x={} y={} radius={}", query, x, y, radius);
         // Return an empty result set for this shim.
         return Collections.emptyList();
     }
-}+}


==== src/main/java/com/abandonware/ai/agent/orchestrator/Step.java ====
--- src/main/java/com/abandonware/ai/agent/orchestrator/Step.java (before)+++ src/main/java/com/abandonware/ai/agent/orchestrator/Step.java (after)@@ -1,40 +1,36 @@ package com.abandonware.ai.agent.orchestrator;
 
 import com.fasterxml.jackson.annotation.JsonProperty;
-import java.util.Collections;
 import java.util.HashMap;
 import java.util.Map;
 
-
-
 /**
- * A single step within a flow definition.  Each step has a type and may
- * reference a tool via the {@code uses} property.  The optional {@code args}
- * map supplies input parameters that are passed to the tool.  Arguments
- * whose values include simple expressions (e.g. "${input.text}") are
- * resolved at runtime by the orchestrator.
+ * A single step within a flow definition.
  */
 public class Step {
-    private NodeType type;
-    private String uses;
-    private Map<String, Object> args;
-
-    public Step() {
-        // default constructor for YAML binding
-    }
 
     @JsonProperty("type")
-    public NodeType getType() {
-        return type;
-    }
+    private NodeType type;
 
-    public void setType(NodeType type) {
-        this.type = type;
-    }
+    @JsonProperty("uses")
+    private String uses;
 
+    @JsonProperty("args")
+    private Map<String, Object> args = new HashMap<>();
 
-    // Allow YAML synonyms like PLANNER/AGENT/SYNTHESIZER by accepting a String 'type'
-    @com.fasterxml.jackson.annotation.JsonProperty("type")
+    // --- Flow DSL extensions ---
+    @JsonProperty("when")
+    private String when;
+
+    @JsonProperty("parallel")
+    private boolean parallel;
+
+    @JsonProperty("retry")
+    private Retry retry;
+
+    public NodeType getType() { return type; }
+
+    /** Accept either enum name or friendly string and map to NodeType. */
     public void setType(String type) {
         if (type == null) { this.type = null; return; }
         String t = type.trim().toUpperCase();
@@ -51,57 +47,22 @@             case "SYNTHESIZER":
                 this.type = NodeType.SYNTH; break;
             default:
-                // Unknown types are ignored at runtime
-                this.type = null;
+                this.type = null; // Unknown types are ignored at runtime
         }
     }
 
+    public String getUses() { return uses; }
+    public void setUses(String uses) { this.uses = uses; }
 
-    @JsonProperty("uses")
-    public String getUses() {
-        return uses;
-    }
-
-    public void setUses(String uses) {
-        this.uses = uses;
-    }
-
-    
-
-    // Support 'ref' as an alias for 'uses' in YAML
-    @com.fasterxml.jackson.annotation.JsonProperty("ref")
-    public void setRef(String ref) {
-        this.uses = ref;
-    }
-
-    @JsonProperty("args")
-    public Map<String, Object> getArgs() {
-        return args == null ? Collections.emptyMap() : args;
-    }
-
-    public void setArgs(Map<String, Object> args) {
-        if (args == null) {
-            this.args = null;
-        } else {
-            this.args = new HashMap<>(args);
-        }
-    }
-
-
-// Support 'params' as an alias for 'args' in YAML
-@com.fasterxml.jackson.annotation.JsonProperty("params")
-public void setParams(java.util.Map<String,Object> params) {
-    setArgs(params);
-
-    // --- Flow DSL extensions ---
-    private String when;
-    private boolean parallel;
-    private Retry retry;
+    public Map<String, Object> getArgs() { return args; }
+    public void setArgs(Map<String, Object> args) { this.args = (args != null ? args : new HashMap<>()); }
 
     public String getWhen(){ return when; }
     public void setWhen(String when){ this.when = when; }
+
     public boolean isParallel(){ return parallel; }
     public void setParallel(boolean parallel){ this.parallel = parallel; }
+
     public Retry getRetry(){ return retry; }
     public void setRetry(Retry retry){ this.retry = retry; }
 
@@ -120,36 +81,4 @@         public String getMode(){ return mode; }
         public void setMode(String v){ this.mode = v; }
     }
-
 }
-
-
-    // --- Flow DSL extensions ---
-    private String when;
-    private boolean parallel;
-    private Retry retry;
-
-    public String getWhen(){ return when; }
-    public void setWhen(String when){ this.when = when; }
-    public boolean isParallel(){ return parallel; }
-    public void setParallel(boolean parallel){ this.parallel = parallel; }
-    public Retry getRetry(){ return retry; }
-    public void setRetry(Retry retry){ this.retry = retry; }
-
-    public static class Retry {
-        @JsonProperty("maxAttempts")
-        private int maxAttempts = 1;
-        @JsonProperty("initialMs")
-        private long initialMs = 0;
-        @JsonProperty("mode")
-        private String mode = "FIXED"; // FIXED | EXP
-
-        public int getMaxAttempts(){ return maxAttempts; }
-        public void setMaxAttempts(int v){ this.maxAttempts = v; }
-        public long getInitialMs(){ return initialMs; }
-        public void setInitialMs(long v){ this.initialMs = v; }
-        public String getMode(){ return mode; }
-        public void setMode(String v){ this.mode = v; }
-    }
-
-}

==== src/main/java/com/abandonware/ai/api/N8nWebhookController.java ====
--- src/main/java/com/abandonware/ai/api/N8nWebhookController.java (before)+++ src/main/java/com/abandonware/ai/api/N8nWebhookController.java (after)@@ -16,6 +16,6 @@     public ResponseEntity<?> accept(@RequestHeader(value="X-Signature", required=false) String sig, @RequestBody String body) {
         if (!verifier.verify(sig, body)) return ResponseEntity.status(401).body("invalid signature");
         String id = jobs.enqueue(body);
-        return ResponseEntity.accepted().body("{"jobId":""+id+""}");
+        return ResponseEntity.accepted().body("{\"jobId\":\""+id+"\"}");
     }
 }


==== src/main/java/com/example/lms/service/rag/selfask/SubQuestion.java ====
--- src/main/java/com/example/lms/service/rag/selfask/SubQuestion.java (before)+++ src/main/java/com/example/lms/service/rag/selfask/SubQuestion.java (after)@@ -13,6 +13,7 @@         this.text = text;
         this.notes = notes;
     }
+
     public Type getType() { return type; }
     public String getText() { return text; }
     public String getNotes() { return notes; }
@@ -20,10 +21,10 @@     @Override
     public String toString() {
         return "SubQuestion{" +
-            "type=" + type +
-            ", text='" + text + ''' +
-            (notes == null ? "" : ", notes='" + notes + '\'' ) +
-            "}";
+                "type=" + type +
+                ", text='" + text + '\'' +
+                (notes == null ? "" : ", notes='" + notes + '\'') +
+                '}';
     }
 
     @Override


